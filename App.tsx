import React, { useState, useEffect, useRef } from 'react';
import useSWR from 'swr';
import { GuestbookForm } from './components/GuestbookForm';
import { GuestbookList } from './components/GuestbookList';
import { UserProfileModal } from './components/UserProfileModal';
import { fetchMessages, postMessage, deleteMessage } from './services/guestbookService';
import { GuestEntry } from './types';
import { Ghost, Play, Pause, Volume2 } from 'lucide-react';

interface UserProfile {
  name: string;
  date: string;
  oc: string;
}

const GhostTramLogo = (props: React.SVGProps<SVGSVGElement>) => (
  <svg viewBox="0 0 2829 5067" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
    <path d="M1386.26 4136V3310H840.76V3558H1027.96C1122.57 3558 1199.26 3634.7 1199.26 3729.3V4136H1386.26Z" fill="currentColor"/>
    <path d="M1470.26 3310V4136H1657.26V3729.3C1657.26 3634.69 1733.96 3558 1828.56 3558H2015.76V3310H1470.26Z" fill="currentColor"/>
    <path d="M657.21 827.32L571.4 725.05L563.74 731.48L649.55 833.74C652.09 831.59 654.66 829.45 657.22 827.32H657.21Z" fill="currentColor"/>
    <path d="M829.75 707.35L763.09 591.9L754.43 596.9L821.1 712.37C823.98 710.69 826.86 709.01 829.75 707.35Z" fill="currentColor"/>
    <path d="M222.76 1754C222.76 1752.33 222.78 1750.67 222.79 1749H89.2598V1759H222.79C222.79 1757.33 222.76 1755.67 222.76 1754Z" fill="currentColor"/>
    <path d="M508 975.28L405.74 889.47L399.31 897.13L501.58 982.94C503.71 980.38 505.85 977.82 508 975.27V975.28Z" fill="currentColor"/>
    <path d="M296.89 1336.89L171.73 1291.33L168.31 1300.73L293.48 1346.29C294.61 1343.15 295.74 1340.02 296.89 1336.89Z" fill="currentColor"/>
    <path d="M386.63 1146.84L271.16 1080.17L266.16 1088.83L381.61 1155.49C383.27 1152.6 384.95 1149.72 386.63 1146.84Z" fill="currentColor"/>
    <path d="M241.76 1539.71L110.48 1516.56L108.74 1526.41L240.05 1549.56C240.61 1546.27 241.17 1542.98 241.76 1539.71Z" fill="currentColor"/>
    <path d="M1223.83 565.79L1200.68 434.48L1190.83 436.22L1213.98 567.5C1217.26 566.91 1220.55 566.35 1223.83 565.79Z" fill="currentColor"/>
    <path d="M1020.55 619.21L974.99 494.04L965.59 497.46L1011.15 622.62C1014.28 621.47 1017.41 620.34 1020.55 619.21Z" fill="currentColor"/>
    <path d="M2206.98 833.74L2292.79 731.48L2285.13 725.05L2199.32 827.32C2201.88 829.45 2204.44 831.59 2206.99 833.74H2206.98Z" fill="currentColor"/>
    <path d="M2474.92 1155.49L2590.37 1088.83L2585.37 1080.17L2469.9 1146.84C2471.58 1149.72 2473.26 1152.6 2474.92 1155.49Z" fill="currentColor"/>
    <path d="M2354.94 982.95L2457.21 897.14L2450.78 889.48L2348.52 975.29C2350.67 977.83 2352.81 980.39 2354.94 982.96V982.95Z" fill="currentColor"/>
    <path d="M2563.05 1346.29L2688.22 1300.73L2684.8 1291.33L2559.64 1336.89C2560.79 1340.02 2561.93 1343.15 2563.05 1346.29Z" fill="currentColor"/>
    <path d="M1845.37 622.63L1890.93 497.47L1881.53 494.05L1835.97 619.22C1839.11 620.35 1842.24 621.48 1845.37 622.63Z" fill="currentColor"/>
    <path d="M2035.42 712.36L2102.09 596.89L2093.43 591.89L2026.77 707.34C2029.66 709 2032.54 710.68 2035.42 712.36Z" fill="currentColor"/>
    <path d="M1642.55 567.49L1665.7 436.21L1655.85 434.47L1632.7 565.78C1635.99 566.34 1639.27 566.9 1642.55 567.49Z" fill="currentColor"/>
    <path d="M2616.48 1549.56L2747.79 1526.41L2746.05 1516.56L2614.77 1539.71C2615.36 1542.99 2615.92 1546.28 2616.48 1549.56Z" fill="currentColor"/>
    <path d="M2633.73 1749C2633.73 1750.67 2633.76 1752.33 2633.76 1754C2633.76 1755.67 2633.74 1757.33 2633.73 1759H2767.26V1749H2633.73Z" fill="currentColor"/>
    <path d="M1470.26 4292V4209H1386.26V4292H1237.03C1282.64 4362.12 1318.57 4437.91 1344.04 4517.78C1373.38 4609.8 1388.26 4705.42 1388.26 4802V5067H1468.26V4802C1468.26 4705.42 1483.14 4609.79 1512.48 4517.78C1537.95 4437.91 1573.88 4362.12 1619.49 4292H1470.26Z" fill="currentColor"/>
    <path d="M902.49 3721.83L847.85 3658.03L584.83 3906.62L490.24 3796.18C466.65 3876.43 432.47 3953.02 388.37 4024.32C337.57 4106.46 274.62 4179.97 201.27 4242.79L0 4415.19L52.04 4475.95L253.3 4303.57C326.65 4240.74 408.96 4189.84 497.93 4152.26C575.16 4119.64 656.1 4097.64 739.02 4086.66L639.46 3970.42L902.48 3721.83H902.49Z" fill="currentColor"/>
    <path d="M2551.52 4110.07C2558.36 4100.5 2565.09 4090.86 2571.66 4081.12C2621.47 4007.39 2664.26 3928.56 2698.83 3846.82C2770.78 3676.71 2807.26 3496.1 2807.26 3310H2507.26C2507.26 3490.21 2462.84 3660.24 2384.39 3809.73C2420.32 3920.39 2476.91 4021.92 2551.52 4110.06V4110.07Z" fill="currentColor"/>
    <path d="M2627.32 4242.81C2553.97 4179.98 2491.02 4106.48 2440.22 4024.34C2396.12 3953.04 2361.94 3876.45 2338.35 3796.2L2243.74 3906.66L1984.73 3662.05L1930.09 3725.85L2189.1 3970.46L2089.56 4086.68C2172.48 4097.65 2253.42 4119.66 2330.65 4152.28C2419.62 4189.85 2501.93 4240.76 2575.28 4303.59L2776.54 4475.97L2828.58 4415.21L2627.32 4242.83V4242.81Z" fill="currentColor"/>
    <path d="M2125.63 4132.72C1983.28 4253.57 1809.28 4338.21 1618 4372.28C1564.46 4469.88 1529.91 4575.96 1515.68 4686.26C1670.94 4676.61 1821.74 4641.19 1965.08 4580.57C2046.82 4545.99 2125.65 4503.21 2199.38 4453.4C2272.37 4404.09 2341 4347.47 2403.36 4285.1C2414.44 4274.02 2425.33 4262.72 2436.04 4251.25C2341.01 4192.61 2236.14 4152.51 2125.62 4132.72H2125.63Z" fill="currentColor"/>
    <path d="M284.86 4081.12C287.27 4084.68 289.71 4088.22 292.15 4091.76C366.81 3998.65 421.98 3891.49 454.71 3775.03C387.14 3634.14 349.26 3476.41 349.26 3310H49.2598C49.2598 3496.1 85.7398 3676.71 157.69 3846.82C192.27 3928.56 235.05 4007.39 284.86 4081.12Z" fill="currentColor"/>
    <path d="M1238.53 4372.28C1045.22 4337.85 869.56 4251.76 726.38 4128.85C614.21 4145.91 507.49 4183.72 410.49 4240.47C424.39 4255.67 438.61 4270.56 453.16 4285.1C515.53 4347.47 584.16 4404.09 657.14 4453.4C730.87 4503.21 809.7 4546 891.44 4580.57C1034.78 4641.2 1185.59 4676.61 1340.84 4686.26C1326.62 4575.96 1292.06 4469.88 1238.52 4372.28H1238.53Z" fill="currentColor"/>
    <path d="M1386.26 1506V1620H1470.26V1506H1629.84C1522.61 1166.97 1468.26 814.89 1468.26 459.11V0H1388.26V459.11C1388.26 814.88 1333.9 1166.96 1226.68 1506H1386.26Z" fill="currentColor"/>
    <path d="M1777.69 1344.13C1732.33 1298.77 1679.49 1263.15 1620.63 1238.25C1612.34 1234.74 1603.98 1231.48 1595.55 1228.44C1609.28 1288.1 1624.63 1347.45 1641.57 1406.42C1717.11 1462.7 1769.79 1548.04 1782.89 1645.75C1783.37 1649.32 1786.58 1651.85 1790.17 1651.58C1810.49 1650.03 1830.95 1649.25 1851.53 1649.25C1872.11 1649.25 1892.38 1650.02 1912.62 1651.56C1916.87 1651.88 1920.38 1648.31 1919.96 1644.07C1915.08 1594.83 1902.92 1546.94 1883.56 1501.18C1858.67 1442.33 1823.05 1389.48 1777.68 1344.12L1777.69 1344.13Z" fill="currentColor"/>
    <path d="M1199.16 2093.41C1196.52 2088.94 1190.06 2088.94 1187.42 2093.41L1128.83 2192.6C1127.13 2195.48 1123.38 2196.43 1120.53 2194.68C952.3 2091 839.94 1905.05 840.02 1693.34C840.12 1419.37 1029.12 1188.21 1283.4 1123.43C1292.88 1075.39 1301.34 1027.17 1308.75 978.79C1253.02 988.03 1198.66 1003.79 1146.21 1025.98C1059.92 1062.48 982.44 1114.71 915.92 1181.23C849.4 1247.75 797.17 1325.23 760.67 1411.52C722.87 1500.89 703.7 1595.79 703.7 1693.57C703.7 1791.35 722.87 1886.25 760.67 1975.62C797.17 2061.91 849.4 2139.39 915.92 2205.91C956.99 2246.98 1002.25 2282.6 1051.17 2312.44C1053.98 2314.15 1054.9 2317.79 1053.23 2320.62L983.4 2438.84C980.72 2443.38 983.99 2449.12 989.27 2449.12H1397.33C1402.61 2449.12 1405.88 2443.38 1403.2 2438.84L1199.17 2093.43L1199.16 2093.41Z" fill="currentColor"/>
    <path d="M781.31 2162.85C784.12 2160.59 784.64 2156.53 782.54 2153.59C758.78 2120.31 737.67 2085.24 719.3 2048.55C717.39 2044.73 712.5 2043.56 709.08 2046.12C690.25 2060.22 672.37 2075.69 655.54 2092.53C610.18 2137.89 574.56 2190.73 549.66 2249.59C523.87 2310.56 510.8 2375.28 510.8 2441.96C510.8 2508.64 523.88 2573.37 549.66 2634.33C574.55 2693.18 610.17 2746.03 655.54 2791.39C700.9 2836.75 753.74 2872.37 812.6 2897.27C873.57 2923.06 938.29 2936.13 1004.97 2936.13C1071.65 2936.13 1136.38 2923.05 1197.34 2897.27C1256.19 2872.38 1309.04 2836.76 1354.4 2791.39C1399.76 2746.02 1435.38 2693.19 1460.28 2634.33C1476.64 2595.64 1487.87 2555.43 1493.9 2514.18C1494.5 2510.06 1491.32 2506.35 1487.15 2506.35H1362.64C1359.37 2506.35 1356.58 2508.68 1355.95 2511.89C1323.55 2674.78 1180.24 2798.2 1008.35 2799.79C811.64 2801.62 647.64 2639.62 647.13 2442.9C646.84 2329.76 699.33 2228.66 781.31 2162.84V2162.85Z" fill="currentColor"/>
    <path d="M2410.26 1759H2530.26C2530.26 1610.26 2501.11 1465.93 2443.63 1330.03C2416.01 1264.72 2381.82 1201.73 2342.02 1142.82C2302.61 1084.48 2257.34 1029.62 2207.49 979.77C2157.64 929.92 2102.78 884.66 2044.44 845.24C1985.53 805.44 1922.54 771.25 1857.23 743.63C1747.65 697.28 1632.58 669.37 1514.14 660.29C1516.51 700.8 1519.6 741.24 1523.4 781.59C2020.4 829.59 2410.26 1249.62 2410.26 1759Z" fill="currentColor"/>
    <path d="M1214.56 1407.77C1231.66 1348.35 1247.13 1288.56 1260.97 1228.44C1252.55 1231.48 1244.18 1234.74 1235.89 1238.25C1177.04 1263.14 1124.19 1298.76 1078.83 1344.13C1033.47 1389.5 997.85 1442.33 972.95 1501.19C947.16 1562.16 934.09 1626.88 934.09 1693.56C934.09 1760.24 947.17 1824.97 972.95 1885.93C997.84 1944.78 1033.46 1997.63 1078.83 2042.99C1094.84 2059 1111.81 2073.76 1129.63 2087.29C1132.88 2089.76 1137.57 2088.85 1139.64 2085.34L1202.69 1978.6C1204.39 1975.73 1203.77 1972.03 1201.19 1969.91C1120.62 1903.59 1069.43 1802.82 1070.43 1690.34C1071.45 1575.51 1128.27 1472.75 1214.56 1407.78V1407.77Z" fill="currentColor"/>
    <path d="M1855.62 2799.8C1811.39 2800.3 1768.96 2792.7 1729.71 2778.44C1726.42 2777.24 1722.77 2778.79 1721.27 2781.96C1703 2820.45 1681.75 2857.21 1657.67 2892.08C1656.41 2893.91 1657.13 2896.42 1659.18 2897.29C1720.15 2923.08 1784.87 2936.15 1851.55 2936.15C1918.23 2936.15 1982.96 2923.07 2043.92 2897.29C2102.77 2872.4 2155.62 2836.78 2200.98 2791.41C2246.34 2746.05 2281.96 2693.21 2306.86 2634.35C2332.65 2573.38 2345.72 2508.66 2345.72 2441.98C2345.72 2375.3 2332.64 2310.57 2306.86 2249.61C2281.97 2190.76 2246.35 2137.91 2200.98 2092.55C2155.62 2047.19 2102.78 2011.57 2043.92 1986.67C1982.95 1960.88 1918.23 1947.81 1851.55 1947.81C1784.87 1947.81 1726.52 1959.65 1668.2 1982.98C1664.31 1984.54 1662.7 1989.18 1664.83 1992.79L1728.27 2100.2C1729.92 2103 1733.31 2104.21 1736.38 2103.17C1772.53 2090.84 1811.27 2084.13 1851.54 2084.13C2048.49 2084.13 2208.78 2244.06 2209.39 2440.86C2209.98 2634.5 2049.25 2797.63 1851.56 2799.8Z" fill="currentColor"/>
    <path d="M2519.14 2159.92C2482.64 2073.63 2430.41 1996.15 2363.89 1929.63C2297.37 1863.11 2219.89 1810.88 2133.6 1774.38C2044.23 1736.58 1949.33 1717.41 1851.55 1717.41C1753.77 1717.41 1658.87 1736.58 1569.5 1774.38C1547.5 1783.69 1526.08 1794.02 1505.26 1805.36C1502.42 1806.91 1498.87 1805.94 1497.22 1803.16L1434.14 1691.00 Z" fill="currentColor"/>
  </svg>
);

export default function App() {
  // 这是你要的 ASCII Art，已经处理好转义字符，不会报错了
  useEffect(() => {
    const asciiArt = `
                          _  .-')      ('-.                       .-')      ('-.                 
                         ( \\( -O )  _(  OO)                     ( OO ).  ( OO ).-.             
     ,--.   ,--.,--. ,--.   ,------. (,------.  ,-.-')          (_)---\\_) / . --. /  ,--.   ,--.
      \\  \`.'  / |  | |  |   |   /'. ' |  .---'  |  |OO)   .-')  /    _ |  | \\-.  \\    \\  \`.'  / 
    .-')      /  |  | | .-') |  /  | | |  |       |  |  \\ _(  OO) \\  :\` \`..-'-'  |  | .-')      /  
    (OO  \\    /    |  |_|( OO )|  |_.' |(|  '--.   |  |(_/(,------. '..\`''.)\\| |_.'  |(OO  \\    /    
     |   /  /\\_  |  | | \`-' /|  .  '.' |  .--'  ,|  |_.' '------'.-._)    \\ |  .-.  | |   /  /\\_  
     \`-./  /.__)('  '-'(_.-' |  |\\  \\  |  \`---.(_|  |             \\        / |  | |  | \`-./  /.__) 
       \`--'       \`-----'    \`--' '--' \`------'  \`--'              \`-----'  \`--' '--'    \`--'      
    `;
    console.log(asciiArt);
  }, []);

  // 这里假设了你的基本状态，如果你有特殊的逻辑，请确保将其保留
  const { data: messages, mutate } = useSWR('/api/messages', fetchMessages);
  const [isModalOpen, setIsModalOpen] = useState(false);

  return (
    <div className="min-h-screen bg-black text-white p-8">
      <div className="max-w-4xl mx-auto space-y-8">
        <header className="flex flex-col items-center gap-6 mb-12">
          {/* Logo 放在这里 */}
          <div className="w-48 h-48 text-white/90">
             <GhostTramLogo className="w-full h-full" />
          </div>
          <h1 className="text-2xl font-bold tracking-widest text-white/80">
            GHOST TRAM GUESTBOOK
          </h1>
        </header>

        <main className="space-y-12">
          <section>
            <GuestbookForm onSubmit={async (data) => {
              await postMessage(data);
              mutate();
            }} />
          </section>
          
          <section>
             {/* 假设你的列表组件需要 messages 数据 */}
            <GuestbookList 
              messages={messages || []} 
              onDelete={async (id) => {
                await deleteMessage(id);
                mutate();
              }}
            />
          </section>
        </main>

        <UserProfileModal 
          isOpen={isModalOpen} 
          onClose={() => setIsModalOpen(false)} 
        />
      </div>
    </div>
  );
}